---
layout: post
title:  DB 기초 시리즈1 - DB인덱스
date:   2019-01-24
description: DB기초 시리즈의 DB인덱스에 대한 설명입니다. 
tags: [DB, Databases, 기초, DBMS, 인덱스 ]
category: DB
---

## DB인덱스

면접에서 DB인덱스는 단골질문입니다. 개념을 알고만 있으면 안됩니다. 원리를 알고 있어야 합니다.

저도 이번 post를 토대로 DB인덱스를 완전히 이해해보려합니다.



위키 정의를 한 번 살펴보겠습니다 

> **인덱스**(영어: index)는 데이터베이스 분야에 있어서 테이블에 대한 동작의 속도를 높여주는 자료 구조를 일컫는다. 고속의 검색 동작뿐만 아니라 레코드 접근과 관련 효율적인 순서 매김 동작에 대한 기초를 제공한다.

위키 정의의 느낌으로는 특정지점에 빠르게 접근할 수 있는 방법이라고 말하고 있는 것 같습니다.



조금 더 자세한 예시를 살펴보도록 하겠습니다.

```SQL
select content from board where title = "DB인덱스"
```

DBMS를 프로젝트에서 한 번이라도 써보셨다면 써보았을 평범한 쿼리문입니다. 누구나 알고 있고요. 혹시 이 쿼리문이 어떤식으로 동작하는지 생각해보신적 있나요? 대부분이 그냥 지나치기 마련입니다. 그래서 이번 기회에 완벽히 파악해보도록 하겠습니다.



#### FULL TABLE SCAN

위의 예시에서 만약 index가 설정되어 있지 않다면 Database는 title이 "DB인덱스"인 것을 찾기 위해서 Full table 한다고 합니다. 이 방법은 row의 값을 순차적으로 scan하며 비교합니다. 그런 만큼 속도도 늘릴 것이며 Disk를 읽기 위한 I/O 자원 사용이 많아질 것입니다. 총체적 난국이죠. 이를 해결하기 위해 DB index가 필요합니다.



#### DB 인덱스

인덱스는 쉽게 말하면 사전의 인덱스와 다르지 않습니다. 사전에서 단어를 찾을 때 우리는 A, B, C, D가 적힌 인덱스를 보면서 Database라는 단어를 조금 더 쉽게 찾을 수 있습니다. 만약 사전에 인덱스가 없다면 모든 사전을 다 찾아보고 Databases를 찾을 수 있을 것입니다. 어느방법이 더 빨라 보이나요? 당연히 인덱스를 이용하는 방법이 더 효율적이고 빠릅니다.

여기서 주의할 점이 있습니다. index가 마냥 좋은 것은 아닙니다. 인덱스는 table마다 여러개를 생성할 수 있는데요, update, insert, delete를 할 때마다 테이블의 변경 뿐만 아니라 index의 변경도 이루어지기 때문에 오히려 늦어질 수 있습니다.



#### B-Tree 인덱스

DBMS에서 가장 일반적인 인덱스는 B-Tree 인덱스입니다.

![image-20190129231927124](/Users/veo/Library/Application Support/typora-user-images/image-20190129231927124.png)

브랜치 블럭은 분기를 목적으로 합니다. 여기서 가장 중요한 것은 Leaf Block입니다. Leaf Block안에는 인덱스를 구성하는 칼럼의 데이터와 해당 데이터를 가지고 있는 행의 위치를 가리키는 레코드 식별자로 구성되어 있습니다. 리프 블록은 양방향 링크를 가지고 있습니다. 이것을 통해서 오름 차순, 내림 차순 검색을 쉽게 할 수 있습니다. 인덱스는 해당 칼럼 데이터로 정렬된다. 만약 인덱스 데이터의 값이 같으면 레코드 식별자의 순서로 저장된다.  B -Tree인덱스는 "=", BETWEEN, 등과 같은 연산자로 검색하는 범위 검색에 적합하다고 합니다. 이제 어느정도 원리를 알았으니 더 자세한 예를 보도록 하겠습니다.



![image-20190129232630428](/Users/veo/Library/Application Support/typora-user-images/image-20190129232630428.png)

위와 같은 인덱스가 있다고 가정합니다. 원하는 값을 찾는 과정을 살펴봅시다.

1단계입니다. 브랜치 블록의 가장 왼쪽 값이 찾고자 하는 값보다 작거나 같으면 왼쪽 포인터로 이동합니다. 

2단계입니다. 찾고자 하는 값이 브랜치 블록의 값들 사이에 존재한다면 가운데 포인터로 이동합니다. 

3단계입니다. 찾고자 하는 값이 오른쪽에 있는 값보다 크면 오른쪽 포인터로 이동합니다.

위와 같은 과정을 찾을 때까지 반복합니다.

원하는 값을 찾게 된다면 레코드 식별자를 이용해서 테이블을 액세스하여 원하는 데이터들을 가져올 수 있습니다.






#### 참고자료

https://nesoy.github.io/articles/2017-07/DBIndex

https://jojoldu.tistory.com/243

https://jeong-pro.tistory.com/114

http://www.gurubee.net/lecture/2926

https://asfirstalways.tistory.com/333

http://www.dbguide.net/db.db?cmd=view&boardUid=148209&boardConfigUid=9&categoryUid=216&boardIdx=136&boardStep=1